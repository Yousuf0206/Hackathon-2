{"openapi":"3.1.0","info":{"title":"Phase II Todo API","description":"Multi-user todo application with JWT authentication","version":"1.0.0"},"paths":{"/health":{"get":{"summary":"Health Check","description":"Health check endpoint.\nReturns 200 OK if service is running.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/register":{"post":{"tags":["auth"],"summary":"Register","description":"Register a new user account.\n\nT025: POST /api/auth/register\n- Validates email format\n- Checks uniqueness (409 if exists)\n- Hashes password\n- Creates user\n- Generates JWT with user_id in sub claim\n- Returns 201 with user and token\n\nT031: Input validation\n- 400 for missing fields\n- 400 for invalid email format\n- 400 for password < 8 chars","operationId":"register_api_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate user and issue JWT token.\n\nT026: POST /api/auth/login\n- Validates credentials\n- Verifies password hash\n- Generates JWT with user_id in sub claim\n- Returns 200 with user and token\n- 401 on invalid credentials without leaking user existence\n\nT031: Error handling\n- 400 for missing fields\n- 401 for invalid credentials","operationId":"login_api_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/todos":{"post":{"tags":["todos"],"summary":"Create Todo","description":"Create a new todo item.\n\nT032: POST /api/todos\n- Extracts user_id from JWT (get_current_user dependency)\n- Validates title (required, trim whitespace, max 500 chars)\n- Validates description (optional, max 5000 chars)\n- Creates todo with user_id from JWT (never from request body)\n- Sets completed=false\n- Returns 201 with created todo\n\nT038: Error handling\n- 400 for empty title\n- 401 for expired token (handled by get_current_user)","operationId":"create_todo_api_todos_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["todos"],"summary":"Get Todos","description":"Get all todos for the authenticated user.\n\nT033: GET /api/todos\n- Extracts user_id from JWT\n- Queries todos filtered by user_id (WHERE user_id = <jwt_user_id>)\n- Returns 200 with list sorted by created_at DESC (newest first)\n\nCRITICAL: User isolation enforced - only returns current user's todos.","operationId":"get_todos_api_todos_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/todos/{todo_id}":{"get":{"tags":["todos"],"summary":"Get Todo By Id","description":"Get a specific todo by ID.\n\nT039: GET /api/todos/{todo_id}\n- Extracts user_id from JWT\n- Queries todo with WHERE id = <todo_id> AND user_id = <jwt_user_id>\n- Returns 404 (not 403) if not found or unauthorized to prevent enumeration\n\nCRITICAL: Returns 404 on ownership violations (not 403).","operationId":"get_todo_by_id_api_todos__todo_id__get","parameters":[{"name":"todo_id","in":"path","required":true,"schema":{"type":"string","title":"Todo Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["todos"],"summary":"Update Todo","description":"Update todo title and/or description.\n\nT047: PUT /api/todos/{todo_id}\n- Extracts user_id from JWT\n- Validates title (required, trim whitespace, max 500 chars)\n- Validates description (optional, max 5000 chars)\n- Queries todo with ownership check (WHERE id = <todo_id> AND user_id = <jwt_user_id>)\n- Updates title/description and updated_at timestamp (completed field unchanged)\n- Returns 200 with updated todo (404 if not found/unauthorized, 400 for validation errors)","operationId":"update_todo_api_todos__todo_id__put","parameters":[{"name":"todo_id","in":"path","required":true,"schema":{"type":"string","title":"Todo Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["todos"],"summary":"Delete Todo","description":"Delete a todo.\n\nT050: DELETE /api/todos/{todo_id}\n- Extracts user_id from JWT\n- Queries todo with ownership check (WHERE id = <todo_id> AND user_id = <jwt_user_id>)\n- Deletes from database\n- Returns 204 No Content (404 if not found/unauthorized)","operationId":"delete_todo_api_todos__todo_id__delete","parameters":[{"name":"todo_id","in":"path","required":true,"schema":{"type":"string","title":"Todo Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/todos/{todo_id}/complete":{"patch":{"tags":["todos"],"summary":"Toggle Todo Completion","description":"Toggle todo completion status.\n\nT043: PATCH /api/todos/{todo_id}/complete\n- Extracts user_id from JWT\n- Validates completed field (required boolean)\n- Queries todo with ownership check (WHERE id = <todo_id> AND user_id = <jwt_user_id>)\n- Updates completed status and updated_at timestamp\n- Returns 200 with updated todo (404 if not found/unauthorized)","operationId":"toggle_todo_completion_api_todos__todo_id__complete_patch","parameters":[{"name":"todo_id","in":"path","required":true,"schema":{"type":"string","title":"Todo Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoCompletionUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TodoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/{user_id}/chat":{"post":{"tags":["chat","chat"],"summary":"Chat","description":"Process a chat message and return AI response.\n\nPer spec section 6 - Processing Rules:\n1. Authenticate request\n2. Validate input schema\n3. Fetch conversation history (if exists)\n4. Store user message\n5. Run agent with history + new message\n6. Execute MCP tools (if invoked)\n7. Store assistant message\n8. Return response\n\nPer constitution - Authentication Law:\n- user_id in path MUST match authenticated user from JWT","operationId":"chat_api__user_id__chat_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AuthResponse":{"properties":{"user":{"$ref":"#/components/schemas/UserResponse"},"token":{"type":"string","title":"Token"}},"type":"object","required":["user","token"],"title":"AuthResponse","description":"Authentication response with user and token."},"ChatRequest":{"properties":{"conversation_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Conversation Id","description":"Optional conversation ID to continue existing conversation"},"message":{"type":"string","maxLength":10000,"minLength":1,"title":"Message","description":"User message to process"}},"type":"object","required":["message"],"title":"ChatRequest","description":"Request body for chat endpoint."},"ChatResponse":{"properties":{"conversation_id":{"type":"integer","title":"Conversation Id"},"response":{"type":"string","title":"Response"},"tool_calls":{"items":{"$ref":"#/components/schemas/ToolCallResponse"},"type":"array","title":"Tool Calls"}},"type":"object","required":["conversation_id","response","tool_calls"],"title":"ChatResponse","description":"Response body for chat endpoint."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LoginRequest":{"properties":{"email":{"type":"string","title":"Email"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","password"],"title":"LoginRequest","description":"Login request payload."},"RegisterRequest":{"properties":{"email":{"type":"string","title":"Email"},"password":{"type":"string","minLength":8,"title":"Password"}},"type":"object","required":["email","password"],"title":"RegisterRequest","description":"Registration request payload."},"TodoCompletionUpdate":{"properties":{"completed":{"type":"boolean","title":"Completed"}},"type":"object","required":["completed"],"title":"TodoCompletionUpdate","description":"Request payload for updating todo completion status."},"TodoCreate":{"properties":{"title":{"type":"string","maxLength":500,"minLength":1,"title":"Title"},"description":{"anyOf":[{"type":"string","maxLength":5000},{"type":"null"}],"title":"Description"}},"type":"object","required":["title"],"title":"TodoCreate","description":"Request payload for creating a todo."},"TodoListResponse":{"properties":{"todos":{"items":{"$ref":"#/components/schemas/TodoResponse"},"type":"array","title":"Todos"}},"type":"object","required":["todos"],"title":"TodoListResponse","description":"Response model for list of todos."},"TodoResponse":{"properties":{"id":{"type":"string","title":"Id"},"user_id":{"type":"string","title":"User Id"},"title":{"type":"string","title":"Title"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"completed":{"type":"boolean","title":"Completed"},"created_at":{"type":"string","title":"Created At"},"updated_at":{"type":"string","title":"Updated At"}},"type":"object","required":["id","user_id","title","description","completed","created_at","updated_at"],"title":"TodoResponse","description":"Response model for a single todo."},"TodoUpdate":{"properties":{"title":{"type":"string","maxLength":500,"minLength":1,"title":"Title"},"description":{"anyOf":[{"type":"string","maxLength":5000},{"type":"null"}],"title":"Description"}},"type":"object","required":["title"],"title":"TodoUpdate","description":"Request payload for updating a todo."},"ToolCallResponse":{"properties":{"tool":{"type":"string","title":"Tool"},"arguments":{"additionalProperties":true,"type":"object","title":"Arguments"},"success":{"type":"boolean","title":"Success"},"result":{"title":"Result"}},"type":"object","required":["tool","arguments","success","result"],"title":"ToolCallResponse","description":"Tool call in response."},"UserResponse":{"properties":{"id":{"type":"string","title":"Id"},"email":{"type":"string","title":"Email"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["id","email","created_at"],"title":"UserResponse","description":"User response without password."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}